<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso - DeMasita</title>
    <link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILO VISUAL SOLICITADO --- */
        body { 
            font-family: "Ubuntu", sans-serif; 
            background-color: #f3e6d8; /* Color Crema/Arena */
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            margin: 0; 
        }

        .login-card { 
            background: white; 
            padding: 40px 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            width: 95%; 
            max-width: 400px; 
            text-align: center; 
        }

        .login-card h2 { 
            font-family: 'Marck Script', cursive; 
            color: #6f1a07; /* Color Marrón Rojizo */
            margin-bottom: 25px; 
            font-size: 3.5rem; 
        }

        .form-control { 
            width: 100%;
            border-radius: 20px; 
            margin-bottom: 15px; 
            border: 1px solid #ddd;
            padding: 15px 15px; /* Ajustado para balance visual */
            height: auto;
            box-sizing: border-box;
            outline: none;
            transition: all 0.2s;
        }

        .form-control:focus {
            border-color: #f44336; /* Rojo DeMasita */
            box-shadow: 0 0 0 0.2rem rgba(244, 67, 54, 0.25);
        }

        .btn-entrar { 
            background-color: #f44336; /* Rojo Principal */
            color: white; 
            border-radius: 20px; 
            width: 100%; 
            border: none; 
            padding: 12px; 
            font-weight: bold; 
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: 0.3s ease;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-entrar:hover { 
            background-color: #d32f2f; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            color: white;
        }

        .toggle-link { 
            color: #6f1a07; 
            cursor: pointer; 
            text-decoration: underline; 
            font-size: 0.9rem;
            display: block;
            margin-top: 20px;
            background: none;
            border: none;
            width: 100%;
        }

        /* Mensajes de feedback */
        #mensaje {
            margin-top: 15px;
            padding: 10px;
            border-radius: 10px;
            display: none;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background-color: #e0f2fe; color: #0369a1; border: 1px solid #bae6fd; }
    </style>
</head>
<body>

<div class="login-card">
    <h2 id="titulo">Iniciar Sesión</h2>
    
    <div class="input-group">
        <input type="email" id="email" class="form-control" placeholder="Correo electrónico">
    </div>

    <div class="input-group">
        <input type="password" id="password" class="form-control" placeholder="Contraseña">
    </div>

    <button class="btn-entrar" id="btnAccion" onclick="enviarDatos()">Ingresar</button>
    
    <button class="toggle-link" onclick="toggleModo()" id="btnModo">
        <span id="txtToggle">¿No tienes cuenta?</span> Regístrate aquí
    </button>

    <div id="mensaje"></div>
</div>

<script>
    // --- CONFIGURACIÓN ---
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxSU_GZQvd8zYwBr-gurnn-cfMustpVnsZB0QQvdMEbvSiOkrt0MXr0KIoqSwidBQgFgQ/exec";
    
    let modoActual = "login"; 

    function toggleModo() {
        const titulo = document.getElementById('titulo');
        const btnAccion = document.getElementById('btnAccion');
        const btnModo = document.getElementById('btnModo');
        const divMensaje = document.getElementById('mensaje');

        divMensaje.style.display = "none";

        if (modoActual === "login") {
            modoActual = "registro";
            titulo.innerText = "Crear Cuenta";
            btnAccion.innerText = "Registrarse";
            btnModo.innerHTML = "¿Ya tienes cuenta? Inicia sesión";
        } else {
            modoActual = "login";
            titulo.innerText = "Iniciar Sesión";
            btnAccion.innerText = "Ingresar";
            btnModo.innerHTML = "¿No tienes cuenta? Regístrate aquí";
        }
    }

    async function enviarDatos() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!email || !password) {
            mostrarMensaje("Por favor rellena todos los campos", "error");
            return;
        }

        mostrarMensaje("Comunicando con el servidor...", "loading");

        try {
            const urlCompleta = `${WEB_APP_URL}?email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}&accion=${modoActual}`;
            const respuesta = await fetch(urlCompleta);
            const resultado = await respuesta.text();
            procesarResultado(resultado, email);
        } catch (error) {
            mostrarMensaje("Error al conectar con el servidor.", "error");
            console.error(error);
        }
    }

    function procesarResultado(res, email) {
        switch(res.trim()) {
            case "exito":
                mostrarMensaje("¡Acceso correcto! Redirigiendo...", "success");
                localStorage.setItem("usuarioLogueado", email);
                setTimeout(() => {
                    window.location.href = "https://augedu6-dot.github.io/lukasecurity.github.io/menu.html";
                }, 1200);
                break;
            case "registro_exitoso":
                mostrarMensaje("¡Cuenta creada! Ya puedes iniciar sesión.", "success");
                setTimeout(() => toggleModo(), 1500);
                break;
            case "error_existe":
                mostrarMensaje("Este correo ya está registrado.", "error");
                break;
            case "error_credenciales":
                mostrarMensaje("Correo o contraseña incorrectos.", "error");
                break;
            default:
                mostrarMensaje("Error: " + res, "error");
        }
    }

    function mostrarMensaje(texto, tipo) {
        const div = document.getElementById('mensaje');
        div.style.display = "block";
        div.innerText = texto;
        div.className = tipo; 
    }
</script>

</body>
</html>
