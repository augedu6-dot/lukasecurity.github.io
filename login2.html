<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso al Sistema</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            background-color: var(--card-bg);
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        h2 {
            text-align: center;
            color: var(--text);
            margin-bottom: 1.5rem;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #4b5563;
        }

        input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
        }

        button {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 0.5rem;
        }

        .btn-accion {
            background-color: var(--primary);
            color: white;
        }

        .btn-accion:hover {
            background-color: var(--primary-hover);
        }

        .btn-toggle {
            background: none;
            color: var(--primary);
            font-size: 0.85rem;
            text-decoration: underline;
            width: auto;
            display: inline;
            padding: 0;
            margin: 0;
        }

        #mensaje {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 6px;
            display: none;
            text-align: center;
            font-size: 0.9rem;
        }

        .success { background-color: #dcfce7; color: #166534; }
        .error { background-color: #fee2e2; color: #991b1b; }
        .loading { background-color: #e0f2fe; color: #0369a1; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="titulo">Iniciar Sesión</h2>
    
    <div class="input-group">
        <label for="email">Correo Electrónico</label>
        <input type="email" id="email" placeholder="ejemplo@correo.com">
    </div>

    <div class="input-group">
        <label for="password">Contraseña</label>
        <input type="password" id="password" placeholder="••••••••">
    </div>

    <button class="btn-accion" id="btnAccion" onclick="enviarDatos()">Ingresar</button>
    
    <p style="text-align: center; font-size: 0.85rem; margin-top: 1.5rem;">
        <span id="txtToggle">¿No tienes cuenta?</span> 
        <button class="btn-toggle" onclick="toggleModo()" id="btnModo">Regístrate aquí</button>
    </p>

    <div id="mensaje"></div>
</div>

<script>
    // --- CONFIGURACIÓN ---
    // Reemplaza esto con la URL que te dio Google Apps Script al implementar
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxSU_GZQvd8zYwBr-gurnn-cfMustpVnsZB0QQvdMEbvSiOkrt0MXr0KIoqSwidBQgFgQ/exec";
    
    let modoActual = "login"; 

    // Cambiar entre formulario de Login y Registro
    function toggleModo() {
        const titulo = document.getElementById('titulo');
        const btnAccion = document.getElementById('btnAccion');
        const btnModo = document.getElementById('btnModo');
        const txtToggle = document.getElementById('txtToggle');
        const divMensaje = document.getElementById('mensaje');

        divMensaje.style.display = "none";

        if (modoActual === "login") {
            modoActual = "registro";
            titulo.innerText = "Crear Cuenta";
            btnAccion.innerText = "Registrarse";
            btnModo.innerText = "Inicia sesión";
            txtToggle.innerText = "¿Ya tienes cuenta?";
        } else {
            modoActual = "login";
            titulo.innerText = "Iniciar Sesión";
            btnAccion.innerText = "Ingresar";
            btnModo.innerText = "Regístrate aquí";
            txtToggle.innerText = "¿No tienes cuenta?";
        }
    }

    // Función principal para conectar con el script
    async function enviarDatos() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!email || !password) {
            mostrarMensaje("Por favor rellena todos los campos", "error");
            return;
        }

        mostrarMensaje("Comunicando con el servidor...", "loading");

        try {
            // Construimos la URL con parámetros para el doGet del script
            const urlCompleta = `${WEB_APP_URL}?email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}&accion=${modoActual}`;

            const respuesta = await fetch(urlCompleta);
            const resultado = await respuesta.text();

            procesarResultado(resultado, email);
        } catch (error) {
            mostrarMensaje("Error al conectar: Verifica la URL del script o tu conexión.", "error");
            console.error(error);
        }
    }

    // Lógica basada en la respuesta del Apps Script
    function procesarResultado(res, email) {
        switch(res) {
            case "exito":
                mostrarMensaje("¡Acceso correcto! Redirigiendo...", "success");
                // Guardamos el usuario en LocalStorage antes de irnos
                localStorage.setItem("usuarioLogueado", email);
                
                setTimeout(() => {
                    window.location.href = "https://augedu6-dot.github.io/lukasecurity.github.io/menu.html";
                }, 1200);
                break;

            case "registro_exitoso":
                mostrarMensaje("¡Cuenta creada! Ahora puedes iniciar sesión.", "success");
                setTimeout(() => toggleModo(), 1500);
                break;

            case "error_existe":
                mostrarMensaje("Este correo ya está registrado.", "error");
                break;

            case "error_credenciales":
                mostrarMensaje("Correo o contraseña incorrectos.", "error");
                break;

            default:
                mostrarMensaje("Error del servidor: " + res, "error");
        }
    }

    function mostrarMensaje(texto, tipo) {
        const div = document.getElementById('mensaje');
        div.style.display = "block";
        div.innerText = texto;
        div.className = tipo; 
    }
</script>

</body>

</html>

